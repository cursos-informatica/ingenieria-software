name: Demo CI/CD

on:
  workflow_dispatch:
    inputs:
      environment:                         # ðŸ”¹ INPUT: parÃ¡metro externo
        description: "Entorno de despliegue"
        required: true
        default: "dev"

env:
  APP_NAME: mi-app                         # ðŸ”¹ ENV global (workflow)

jobs:
  build:
    runs-on: ubuntu-latest

    outputs:
      VERSION_OUTPUT: ${{ steps.set_version.outputs.version }}
      # ðŸ”¹ OUTPUT (job): expone la versiÃ³n hacia otros jobs

    steps:
      - name: Calcular versiÃ³n
        id: set_version
        run: |
          version="1.0.${{ github.run_number }}"

          # ðŸ”¹ GITHUB_ENV:
          # Hace disponible VERSION para los siguientes steps
          echo "VERSION_ENV=$version" >> $GITHUB_ENV

          # ðŸ”¹ GITHUB_OUTPUT:
          # Permite que este valor pueda salir del job
          echo "VERSION_OUTPUT=$version" >> $GITHUB_OUTPUT

      - name: Usar variable dentro del mismo job
        run: |
          # ðŸ”¹ Uso de variable creada con GITHUB_ENV
          echo "Building $APP_NAME version $VERSION_ENV"
          echo "Environment: ${{ inputs.environment }}"

  deploy:
    runs-on: ubuntu-latest
    needs: build                           # ðŸ”¹ NEEDS: depende del job build

    steps:
      - name: Deploy
        run: |
          # ðŸ”¹ NO funciona $VERSION_ENV aquÃ­ (porque era GITHUB_ENV del job build)

          # ðŸ”¹ Se usa el output expuesto por el job build
          echo "Deploying version ${{ needs.build.outputs.VERSION_OUTPUT }}"
          echo "To environment: ${{ inputs.environment }}"
